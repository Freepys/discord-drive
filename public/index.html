<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cloud Drive</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; display: flex; height: 100vh; background: #fff; }
        .sidebar { width: 260px; padding: 20px; border-right: 1px solid #dadce0; }
        .main { flex: 1; display: flex; flex-direction: column; background: #f8f9fa; }
        .toolbar { padding: 10px 20px; background: #fff; display: flex; gap: 10px; border-bottom: 1px solid #dadce0; align-items: center; }
        
        .btn { border: none; background: #fff; border-radius: 24px; padding: 8px 16px; display: flex; align-items: center; gap: 8px; cursor: pointer; border: 1px solid #dadce0; font-size: 14px; }
        .btn:hover { background: #f1f3f4; }
        .btn-primary { background: #1a73e8; color: #fff; border: none; }
        .btn-primary:hover { background: #1765cc; }

        input[type="text"] { border: 1px solid #dadce0; border-radius: 4px; padding: 6px 12px; outline: none; }
        
        .content { padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
        .item { background: #fff; border: 1px solid #dadce0; border-radius: 12px; padding: 16px; text-align: center; transition: 0.2s; cursor: pointer; }
        .item:hover { box-shadow: 0 1px 3px rgba(60,64,67,0.3); }
        .item i { font-size: 48px; color: #5f6368; display: block; margin-bottom: 8px; }
        .item.folder i { color: #fabb05; }
        .active-folder { border: 2px solid #1a73e8; }
        
        #loader { position: fixed; bottom: 20px; right: 20px; background: #323232; color: #fff; padding: 12px 24px; border-radius: 8px; display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="color: #5f6368; font-weight: 400;">Drive</h2>
        <div style="margin-top: 20px; color: #1a73e8; display: flex; align-items: center; gap: 12px;">
            <i class="material-icons-outlined">folder</i> Meine Ablage
        </div>
    </div>

    <div class="main">
        <div class="toolbar">
            <input type="text" id="newFolderName" placeholder="Neuer Ordner Name...">
            <button class="btn" onclick="createFolder()"><i class="material-icons-outlined">create_new_folder</i> Erstellen</button>
            <div style="width: 1px; height: 24px; background: #dadce0; margin: 0 10px;"></div>
            <input type="file" id="fileInput" style="display:none" onchange="uploadFile()">
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()"><i class="material-icons-outlined">upload</i> Hochladen</button>
        </div>

        <div class="content" id="view">
            </div>
    </div>

    <div id="loader">Aktion wird ausgeführt...</div>

    <script>
        let selectedFolder = null;

        async function refresh() {
            const res = await fetch('/api/data');
            const data = await res.json();
            const view = document.getElementById('view');
            view.innerHTML = '';

            // Ordner anzeigen
            data.folders.forEach(f => {
                const div = document.createElement('div');
                div.className = `item folder ${selectedFolder === f.id ? 'active-folder' : ''}`;
                div.onclick = () => { selectedFolder = f.id; refresh(); };
                div.innerHTML = `<i class="material-icons-outlined">folder</i><span>${f.name}</span>`;
                view.appendChild(div);
            });

            // Dateien des ausgewählten Ordners anzeigen
            if (selectedFolder) {
                data.files.filter(file => file.folderId === selectedFolder).forEach(file => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.onclick = () => window.location.href = `/download?name=${file.name}`;
                    div.innerHTML = `<i class="material-icons-outlined">description</i><span>${file.name}</span>`;
                    view.appendChild(div);
                });
            }
        }

        async function createFolder() {
            const name = document.getElementById('newFolderName').value;
            if (!name) return alert("Bitte Name eingeben");
            
            showLoader(true);
            await fetch('/api/folders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            document.getElementById('newFolderName').value = '';
            showLoader(false);
            refresh();
        }

        async function uploadFile() {
            if (!selectedFolder) return alert("Wähle erst einen Ordner aus (anklicken)!");
            const file = document.getElementById('fileInput').files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('folderId', selectedFolder);

            showLoader(true);
            await fetch('/upload', { method: 'POST', body: formData });
            showLoader(false);
            refresh();
        }

        function showLoader(show) { document.getElementById('loader').style.display = show ? 'block' : 'none'; }
        
        refresh();
    </script>
</body>
</html>
